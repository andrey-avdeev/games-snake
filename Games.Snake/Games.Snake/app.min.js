function SnakeGame(n,t,i){function ot(n){return n===undefined&&(n={}),n.r===undefined&&(n.r=255),n.g===undefined&&(n.g=255),n.b===undefined&&(n.b=255),n.alphaDecreaseLevel===undefined&&(n.alphaDecreaseLevel=1),n.backgroundColor===undefined&&(n.backgroundColor="black"),n.backgroundStrokeColor===undefined&&(n.backgroundStrokeColor="white"),n.cellStrokeColor===undefined&&(n.cellStrokeColor="black"),n.foodColor===undefined&&(n.foodColor="white"),n.portalColor===undefined&&(n.portalColor="blue"),n.poisonColor===undefined&&(n.poisonColor="red"),n.textColor===undefined&&(n.textColor="white"),n.fps===undefined&&(n.fps=10),n.fpsIncreaseLevel===undefined&&(n.fpsIncreaseLevel=2),n.fpsIncreaseValue===undefined&&(n.fpsIncreaseValue=10),n.increaseDifficultyLevel===undefined&&(n.increaseDifficultyLevel=5),n.portalsRate===undefined&&(n.portalsRate=2),n.poisonRate===undefined&&(n.poisonRate=1),n.direction===undefined&&(n.direction="r"),n.headX===undefined&&(n.headX=10),n.headY===undefined&&(n.headY=0),n.length===undefined&&(n.length=5),n.cellWidth===undefined&&(n.cellWidth=10),n.scoreX===undefined&&(n.scoreX=t.clientWidth/2-20),n.scoreY===undefined&&(n.scoreY=t.clientHeight/2),n.authorX===undefined&&(n.authorX=10),n.authorY===undefined&&(n.authorY=t.clientHeight-10),n.authorDuration===undefined&&(n.authorDuration=2e3),n.helpX===undefined&&(n.helpX=t.clientWidth*4/5),n.helpY===undefined&&(n.helpY=t.clientHeight-10),n.helpDuration===undefined&&(n.helpDuration=4e3),n}function st(n,t,i,r){for(var f=new Array(i),u=0;u<i;u++)r=="r"?f[u]={x:n-u,y:t}:r=="l"?f[u]={x:n+u,y:t}:r=="u"?f[u]={x:n,y:t-u}:r=="d"&&(f[u]={x:n,y:t+u});return f}function tt(){return{x:Math.round(Math.random()*(c-r)/r),y:Math.round(Math.random()*(l-r)/r)}}function it(){return{x:Math.round(Math.random()*(c-r)/r),y:Math.round(Math.random()*(l-r)/r)}}function ht(){return{x:Math.round(Math.random()*(c-r)/r),y:Math.round(Math.random()*(l-r)/r)}}function rt(n,t){return Math.round(Math.random()*(t-n))+n}function ut(n,t,i){for(var r=!1,u=-1;!r&&++u<i.length;)i[u].x==n&&i[u].y==t&&(r=!0);return r}function ct(){var n=f[0].x,t=f[0].y,u;e=="r"?n++:e=="l"?n--:e=="u"?t--:e=="d"&&t++;(n==-1||n==c/r||t==-1||t==l/r||ut(n,t,f)||ut(n,t,v))&&(w=!0);n==a.x&&t==a.y?(u={x:n,y:t},h++,a=tt()):(u=f.pop(),u.x=n,u.y=t);f.unshift(u);h>=i.increaseDifficultyLevel&&(rt(0,10)>=10/i.poisonRate&&v.push(ht()),o.x<0&&s.x<0&&rt(0,10)>=10/i.portalsRate&&(o=it(),s=it()),n=f[0].x,t=f[0].y,n==o.x&&t==o.y&&(head={x:s.x,y:s.y},h++,f.unshift(head),o.x=-r,o.y=-r,s.x=-r,s.y=-r),n==s.x&&t==s.y&&(head={x:o.x,y:o.y},h++,f.unshift(head),o.x=-r,o.y=-r,s.x=-r,s.y=-r));h+1%i.fpsIncreaseLevel==0&&(k=1e3/(b+i.fpsIncreaseValue))}function p(n,t,f){u.fillStyle=f;u.fillRect(n*r,t*r,r,r);u.strokeStyle=i.cellStrokeColor;u.strokeRect(n*r,t*r,r,r)}function lt(){var n,e;for(u.font="11px Arial",u.fillStyle=i.backgroundColor,u.fillRect(0,0,c,l),u.strokeStyle=i.backgroundStrokeColor,u.strokeRect(0,0,c,l),n=0;n<f.length;n++)p(f[n].x,f[n].y,"rgba("+i.r+","+i.g+","+i.b+","+(1-n/(i.alphaDecreaseLevel+f.length))+")");for(p(a.x,a.y,i.foodColor),p(o.x,o.y,i.portalColor),p(s.x,s.y,i.portalColor),n=0;n<v.length;n++)p(v[n].x,v[n].y,i.poisonColor);if(u.fillStyle=i.textColor,e="Score: "+h,u.fillText(e,i.scoreX,i.scoreY),y-startTime<i.authorDuration&&u.fillText("Made by "+et,i.authorX,i.authorY),y-startTime<i.helpDuration){var t=10,r=0,w=i.poisonColor+": poison",b=i.portalColor+": teleport";u.fillText("p: pause",i.helpX,i.helpY-t*r++);u.fillText(b,i.helpX,i.helpY-t*r++);u.fillText(w,i.helpX,i.helpY-t*r++);u.fillText("controls: arrows",i.helpX,i.helpY-t*r++)}}function ft(){y=Date.now();g=y-d;isGamePaused?(u.font="20px Arial",u.fillStyle=i.textColor,u.fillText("pause",10,20)):w||g>k&&(d=y-g%k,ct(),lt());w&&this.start();isGameStopped||requestAnimationFrame(ft)}function nt(n){var t=n.keyCode;switch(t){case 37:e!="r"&&(e="l");break;case 38:e!="d"&&(e="u");break;case 39:e!="l"&&(e="r");break;case 40:e!="u"&&(e="d");break;case 80:isGamePaused=!isGamePaused}}var i=ot(i),u=t.getContext("2d"),c=t.clientWidth,l=t.clientHeight,r=i.cellWidth,e=i.direction,f=[],a,o,s,v=[],w,h,et="Avdeev Andrew",b,k,y,d,g;return this.isGameOver=!1,this.isGameStopped=!1,this.isGamePaused=!1,b=i.fps,k=1e3/b,this.start=function(){h=0;b=i.fps;e=i.direction;w=!1;isGameStopped=!1;isGamePaused=!1;n.addEventListener("keydown",nt);f=st(i.headX,i.headY,i.length,i.direction);a=tt();o={x:-r,y:-r};s={x:-r,y:-r};v=[];d=Date.now();startTime=d;requestAnimationFrame(ft)},this.stop=function(){isGameStopped=!0;n.removeEventListener("keydown",nt)},this.pause=function(){isGamePaused=!0},this.resume=function(){isGamePaused=!1},this}(function(n){var i=n.document.getElementById("canvas"),t=SnakeGame(document,i);t.start();i.onclick=function(){t.isGameStopped?t.start():t.stop()}})(window);